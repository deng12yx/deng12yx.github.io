<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>rmi_1 - BeautyFlower</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Icaurs - Hexo Theme"><meta name="msapplication-TileImage" content="icons/touch-icon-iphone.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icaurs - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="icons/touch-icon-iphone.png"><link rel="apple-touch-icon" sizes="152x152" href="icons/touch-icon-ipad.png"><link rel="apple-touch-icon" sizes="72x72" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="96x96" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="128x128" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="256x256" href="icon/logo.ico"><meta name="description" content="åˆè¯†RMI  æ¦‚å¿µï¼šJava RMI (Remote Method Invocation) æ˜¯ä¸€ç§ç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æœºåˆ¶ï¼Œå…è®¸Javaå¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚"><meta property="og:type" content="blog"><meta property="og:title" content="rmi_1"><meta property="og:url" content="http://example.com/post/a787da62.html"><meta property="og:site_name" content="BeautyFlower"><meta property="og:description" content="åˆè¯†RMI  æ¦‚å¿µï¼šJava RMI (Remote Method Invocation) æ˜¯ä¸€ç§ç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æœºåˆ¶ï¼Œå…è®¸Javaå¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/article/13.png"><meta property="article:published_time" content="2024-06-13T13:31:12.000Z"><meta property="article:modified_time" content="2024-09-28T16:17:22.000Z"><meta property="article:author" content="yyyyyyxnp"><meta property="article:tag" content="java"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/article/13.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/post/a787da62.html"},"headline":"rmi_1","image":["http://example.com/img/article/13.png"],"datePublished":"2024-06-13T13:31:12.000Z","dateModified":"2024-09-28T16:17:22.000Z","author":{"@type":"Person","name":"yyyyyyxnp"},"publisher":{"@type":"Organization","name":"BeautyFlower","logo":{"@type":"ImageObject","url":{"text":"BeautyFlower"}}},"description":"åˆè¯†RMI\r \r æ¦‚å¿µï¼šJava RMI (Remote Method Invocation)\r æ˜¯ä¸€ç§ç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æœºåˆ¶ï¼Œå…è®¸Javaå¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚"}</script><link rel="canonical" href="http://example.com/post/a787da62.html"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="BeautyFlower" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">BeautyFlower</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/deng12yx"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/article/13.png" alt="rmi_1"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item copyright article-title type-2">åŸåˆ›</span><span class="level-item">Posted&nbsp;<time dateTime="2024-06-13T13:31:12.000Z" title="2024/6/13 21:31:12">2024-06-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-28T16:17:22.000Z" title="2024/9/29 00:17:22">2024-09-29</time></span><span class="level-item"><a class="link-muted" href="/categories/RMI/">RMI</a></span><span class="level-item">33 minutes read (About 4931 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile"> rmi_1</h1><div class="copyright article-block type-2"><p>ç‰ˆæƒç”³æ˜ï¼šæœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://example.com/post/a787da62.html" target="_blank">http://example.com/post/a787da62.html</a></p></div><h1 class="title is-3 is-size-4-mobile">rmi_1</h1><div class="content"><h3 id="åˆè¯†rmi">åˆè¯†RMI</h3>
<ul>
<li>æ¦‚å¿µï¼šJava RMI (Remote Method Invocation)
æ˜¯ä¸€ç§ç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æœºåˆ¶ï¼Œå…è®¸Javaå¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚</li>
</ul>
<span id="more"></span>
<ul>
<li><p>demo</p>
<p>RMIClient:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  å®¢æˆ·ç«¯é€šè¿‡LocateRegistry.getRegistryæ–¹æ³•è·å–Registryå¯¹è±¡</span></span><br><span class="line"><span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>, <span class="number">1099</span>);</span><br><span class="line"><span class="comment">//  å®¢æˆ·ç«¯é€šè¿‡lookupæ–¹æ³•è·å–è¿œç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">IRemoteObj</span> <span class="variable">remoteObj</span> <span class="operator">=</span> (IRemoteObj) registry.lookup(<span class="string">&quot;remoteObj&quot;</span>);</span><br><span class="line"><span class="comment">//  å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">System.out.println(remoteObj.sayHello(<span class="string">&quot;Hello, World!&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>RMIServer:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">IRemoteObj</span> <span class="variable">remoteObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteObjImpl</span>();</span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯åˆ›å»ºRegistryå¯¹è±¡</span></span><br><span class="line"><span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯å°†è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°Registryå¯¹è±¡</span></span><br><span class="line">registry.bind(<span class="string">&quot;remoteObj&quot;</span>, remoteObj);</span><br></pre></td></tr></table></figure></li>
<li><p>å®‰å…¨é—®é¢˜</p>
<ol type="1">
<li>RMIå…è®¸åŠ¨æ€åŠ è½½ç±»ï¼Œè¿™å¯èƒ½è¢«æ»¥ç”¨è¿›è¡Œä»£ç æ³¨å…¥æ”»å‡»ã€‚æ¶æ„æœåŠ¡å™¨å¯ä»¥å‘é€æ¶æ„çš„ç±»æ–‡ä»¶ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ‰§è¡Œä»»æ„ä»£ç ã€‚</li>
<li>RMIä¾èµ–Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµè¿›è¡Œä¼ è¾“ã€‚ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¦‚æœå¤„ç†ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´ååºåˆ—åŒ–æ¼æ´ï¼Œä½¿æ”»å‡»è€…å¯ä»¥å‘é€æ¶æ„æ•°æ®ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</li>
</ol></li>
<li><p>ç»„æˆ</p>
<ul>
<li>æ³¨å†Œä¸­å¿ƒï¼šå“ˆå¸Œè¡¨ï¼ŒNaming-&gt;è¿œç¨‹å¯¹è±¡</li>
<li>æœåŠ¡ç«¯ï¼šç”¨ä»£ç†Skeleton(è¿›è¡Œç½‘ç»œè¯·æ±‚)</li>
<li>å®¢æˆ·ç«¯ï¼šè¿æ¥æ³¨å†Œä¸­å¿ƒï¼Œç”¨ä»£ç†Stub(è¿›è¡Œç½‘ç»œè¯·æ±‚)</li>
</ul></li>
<li><p>é€šä¿¡</p>
<ul>
<li>æœåŠ¡ç«¯-&gt;æ³¨å†Œä¸­å¿ƒï¼šç»‘å®šã€é‡ç»‘å®š</li>
<li>æ³¨å†Œä¸­å¿ƒ-&gt;æœåŠ¡ç«¯ï¼šRMIæ³¨å†ŒæœåŠ¡åå‘ç”Ÿæˆ</li>
<li>å®¢æˆ·ç«¯-&gt;æ³¨å†Œä¸­å¿ƒï¼šNaming</li>
<li>æ³¨å†Œä¸­å¿ƒ-&gt;å®¢æˆ·ç«¯ï¼šè·å–Stub</li>
<li>æœåŠ¡ç«¯&lt;-&gt;å®¢æˆ·ç«¯ï¼šJRMPé€šä¿¡</li>
</ul></li>
</ul>
<h3 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h3>
<h4 id="æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡">æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡</h4>
<blockquote>
<p>æœåŠ¡ç«¯æ”»å‡»æ³¨å†Œä¸­å¿ƒï¼šä¸€å¥è¯é€»è¾‘è§£é‡Šï¼šæœåŠ¡ç«¯è°ƒç”¨bind(name,obj)æ³¨å†Œè¿œç¨‹å¯¹è±¡ï¼Œå…¶ä¸­nameï¼Œobjä¼šä»¥åºåˆ—åŒ–æ–¹å¼å‘é€ç»™registryï¼Œregistryååºåˆ—åŒ–å®ƒä»¬ï¼Œè§¦å‘boomğŸ’£ã€‚</p>
</blockquote>
<p>åˆ›å»ºä»£ç ä¸º <code>IRemoteObj remoteObj = new RemoteObjImpl();</code>
ï¼Œå®ç°ç±»ç»§æ‰¿äº†<code>UnicastRemoteObject</code>ç±»ï¼Œå¦‚æœæœåŠ¡ç«¯è¦å°†å¯¹è±¡å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯å¯¼å‡ºåˆ°æ³¨å†Œç«¯ä¸Šå»ç»™å®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¯¥å¯¼å‡ºå¯¹è±¡å°±éœ€è¦ç»§æ‰¿<code>UnicastRemoteObject</code>ï¼Œæ­¤æ—¶çš„ç«¯å£è®¾ç½®ä¸º0</p>
<blockquote>
<p><code>UnicastRemoteObject</code> æ˜¯ Java RMIï¼ˆRemote Method
Invocationï¼‰ä¸­ç”¨äºåˆ›å»ºå•æ’­è¿œç¨‹å¯¹è±¡çš„ä¸€ä¸ªç±»ã€‚å•æ’­è¿œç¨‹å¯¹è±¡æ˜¯æŒ‡åœ¨æŸä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªå®¢æˆ·ç«¯è°ƒç”¨çš„è¿œç¨‹å¯¹è±¡ã€‚è¿™ä¸ªç±»æä¾›äº†åŸºæœ¬çš„åŠŸèƒ½æ¥å¯¼å‡ºè¿œç¨‹å¯¹è±¡ï¼Œä½¿å…¶å¯ä»¥è¢«è¿œç¨‹è®¿é—®ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">UnicastRemoteObject</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> RemoteException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">this</span>.port = port;</span><br><span class="line">    exportObject((Remote) <span class="built_in">this</span>, port);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„çš„<code>exportobject</code>åœ¨æŒ‡å®šç«¯å£ä¸Šå¯¼å‡ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Remote <span class="title function_">exportObject</span><span class="params">(Remote obj, <span class="type">int</span> port)</span></span><br><span class="line">    <span class="keyword">throws</span> RemoteException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> exportObject(obj, <span class="keyword">new</span> <span class="title class_">UnicastServerRef</span>(port));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„çš„<code>UnicastServerRef</code>æ˜¯æœåŠ¡ç«¯å¯¹äºç½‘ç»œè¯·æ±‚çš„å°è£…å¯¹è±¡ï¼Œå®é™…ä¸ŠæœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚å…ˆæ˜¯é€šè¿‡<code>UnicastServerRef</code>æ“ä½œï¼Œè€Œ<code>UnicastServerRef</code>ä¸­æ“ä½œæ˜¯é€šè¿‡<code>StreamRemoteCall</code>æ¥è¿›è¡Œè¯·æ±‚ï¼Œç»§æ‰¿çš„æ˜¯LiveRefç±»çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">UnicastServerRef</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">LiveRef</span>(port));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>LiveRef</code>ç±»ä¸­æ–°å»ºäº†å¯¹è±¡<code>ID</code>ï¼Œå¹¶ä¼ å…¥ç«¯å£å·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LiveRef</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>((<span class="keyword">new</span> <span class="title class_">ObjID</span>()), port);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>port</code>ä¼ å…¥äº†<code>TCPEndpoint</code>ç±»çš„<code>getLocalEndpoint</code>æ–¹æ³•ï¼ŒçŒœæµ‹è¿™é‡Œæ˜¯å»ºç«‹è¿æ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LiveRef</span><span class="params">(ObjID objID, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(objID, TCPEndpoint.getLocalEndpoint(port), <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getLocalEndpoint</code>æ–¹æ³•ä¸­å¢åŠ äº†ä¸¤ä¸ªå‚æ•°è°ƒç”¨äº†åŒåæ–¹æ³•ï¼Œè°ƒç”¨çš„<code>getLocalEndpoint</code>æ˜¯è·å–æœ¬åœ°<code>IP</code>å€¼å’Œä¼ å…¥çš„ç«¯å£å·ï¼Œæ­¤æ—¶ç«¯å£å·è¿˜æ˜¯0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TCPEndpoint <span class="title function_">getLocalEndpoint</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getLocalEndpoint(port, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿”å›åˆ°ä¸Šé¢<code>LiveRef</code>çš„<code>this</code>æ–¹æ³•ä¸­ï¼Œæ­¤æ—¶<code>LiveRef</code>å¯¹è±¡ä¸­çš„å‚æ•°å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614141242918.png" alt="image-20240614141242918" style="zoom:50%;"></p>
<p>è¿”å›åˆ°ä¸Šé¢çš„<code>UnicastServerRef</code>çš„<code>super</code>æ–¹æ³•ä¸­ï¼Œæ­¤å¤„<code>UnicastServerRef</code>å¯¹è±¡çš„å‚æ•°å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614141424469.png" alt="image-20240614141424469" style="zoom:33%;"></p>
<p>è¿”å›åˆ°<code>UnicastRemoteObject</code>çš„<code>exportObject</code>æ–¹æ³•ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ä¼ å…¥çš„<code>UnicastServerRef</code>å¯¹è±¡çš„<code>exportObject</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Remote <span class="title function_">exportObject</span><span class="params">(Remote obj, UnicastServerRef sref)</span></span><br><span class="line">    <span class="keyword">throws</span> RemoteException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// if obj extends UnicastRemoteObject, set its ref.</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> UnicastRemoteObject) &#123;</span><br><span class="line">        ((UnicastRemoteObject) obj).ref = sref;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sref.exportObject(obj, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UnicastServerRef</code>å¯¹è±¡çš„<code>exportObject</code>æ–¹æ³•ä¸­å®ç°äº†åˆ›å»º<code>RemoteObjImpl</code>å¯¹è±¡çš„åŠ¨æ€ä»£ç†<code>stub</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stub = Util.createProxy(implClass, getClientRef(), forceStubUse);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>getClientRef()</code>ä¼šæ–°å»ºä¸€ä¸ª<code>UnicastRef</code>å¯¹è±¡ï¼Œè€Œè¿™é‡Œçš„<code>ref</code>å°±æ˜¯åˆ›å»ºçš„<code>LiveRef</code>å¯¹è±¡ï¼Œ<code>UnicastRef</code>æ˜¯å®¢æˆ·ç«¯å¯¹äºç½‘ç»œè¯·æ±‚çš„å°è£…å¯¹è±¡ï¼Œå®é™…ä¸Šå®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚å…ˆæ˜¯é€šè¿‡<code>UnicastRef</code>æ“ä½œï¼Œè€Œ<code>UnicastRef</code>ä¸­æ“ä½œæ˜¯é€šè¿‡<code>StreamRemoteCall</code>æ¥è¿›è¡Œè¯·æ±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> RemoteRef <span class="title function_">getClientRef</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UnicastRef</span>(ref);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ------------------------------------</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">UnicastRef</span><span class="params">(LiveRef liveRef)</span> &#123;</span><br><span class="line">    ref = liveRef;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„<code>stub</code>å°±æ˜¯ä¸º<code>getClientRef()</code>çš„è¿”å›åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œ<code>stub</code>çš„æ•°æ®å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614142318346.png" alt="image-20240614142318346" style="zoom:50%;"></p>
<p>ç„¶åæ–°å»º<code>target</code>å¯¹è±¡ï¼Œä¼ å…¥å‚æ•°åˆ†åˆ«ä¸º<code>RemoteObjImpl</code>å®ç°ç±»ï¼ˆåŒ…å«p~ortå’Œ<code>UnicastServerRef</code>å¯¹è±¡ï¼‰ï¼Œ<code>UnicastServerRef</code>å¯¹è±¡æœ¬èº«ï¼Œ<code>UnicastRef</code>ä»£ç†å¯¹è±¡ï¼Œ<code>LiveRef</code>çš„<code>objID</code>ï¼Œ<code>permanent</code>ä¸º<code>false</code>ï¼Œä»£è¡¨éæ°¸ä¹…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Target</span>(impl, <span class="built_in">this</span>, stub, ref.getObjID(), permanent);</span><br></pre></td></tr></table></figure>
<p>ç„¶åè°ƒç”¨<code>LiveRef</code>å¯¹è±¡çš„<code>exportObject</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref.exportObject(target);</span><br></pre></td></tr></table></figure>
<p>ç„¶åè°ƒç”¨<code>ep</code>(<code>TCPEndpoint</code>å¯¹è±¡)çš„<code>exportObject</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target target)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    ep.exportObject(target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè°ƒç”¨<code>TCPTransport</code>çš„æ–¹æ³•ï¼Œ<code>TCPTransport</code>æ˜¯åœ¨ä¸Šé¢<code>TCPEndpoint</code>çš„<code>getLocalEndpoint</code>å®šä¹‰çš„ï¼Œå®šä¹‰çš„å‚æ•°åŒ…æ‹¬<code>ip</code>å’Œç«¯å£å·ï¼Œåº”è¯¥æ˜¯ç”¨äºå»ºç«‹è¿æ¥çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target target)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    transport.exportObject(target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯<code>TCPTransport</code>å¯¹è±¡çš„å‚æ•°ä¿¡æ¯</p>
<p><img src="/post/a787da62/image-20240614143127357.png" alt="image-20240614143127357" style="zoom:50%;"></p>
<p>åœ¨<code>TCPTransport</code>çš„<code>exportObject</code>æ–¹æ³•ä¸­å®ç°äº†<code>listen</code>è¿›è¡Œç«¯å£ç›‘å¬</p>
<p><img src="/post/a787da62/image-20240614143326427.png" alt="image-20240614143326427" style="zoom:33%;"></p>
<p>åœ¨<code>listen</code>å‡½æ•°ä¸­å®ç°äº†åˆ›å»ºæœåŠ¡ç«¯<code>socket</code>ï¼Œåˆ›å»ºæ–°è¿›ç¨‹</p>
<p><img src="/post/a787da62/image-20240614143425352.png" alt="image-20240614143425352" style="zoom: 33%;"></p>
<p><code>TCPTransport</code>å¯¹è±¡çš„å˜é‡æ›´æ–°å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614143618651.png" alt="image-20240614143618651" style="zoom:50%;"></p>
<p>è‡³æ­¤ï¼ŒæœåŠ¡ç«¯è¿œç¨‹æœåŠ¡åˆ›å»ºå®Œæˆï¼Œæ€»çš„æ¥è¯´å…ˆç¡®å®š<code>IP</code>ï¼Œç„¶åé€æ­¥åˆ›å»ºå®¢æˆ·ç«¯ä»£ç†<code>Stub</code>(ä¸ºäº†å®¢æˆ·ç«¯èƒ½é€šè¿‡è¯¥ä»£ç†å’ŒæœåŠ¡ç«¯é€šä¿¡)ï¼Œç„¶ååˆ›å»ºè¿æ¥<code>socket</code></p>
<h4 id="åˆ›å»ºæ³¨å†Œä¸­å¿ƒç»‘å®š">åˆ›å»ºæ³¨å†Œä¸­å¿ƒ+ç»‘å®š</h4>
<p>æœåŠ¡ç«¯åˆ›å»ºæ³¨å†Œä¸­å¿ƒå’Œåˆ›å»ºè¿œç¨‹è®¿é—®çš„æµç¨‹ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨æŸç«¯å£å¼€å¯ç½‘ç»œé€šä¿¡æœåŠ¡ï¼Œä¸ªåˆ«å‚æ•°æœ‰ä¸€å®šåŒºåˆ«ï¼Œåˆ›å»ºæ³¨å†Œä¸­å¿ƒæŒ‡å®šç«¯å£å·ä¸º1099ï¼ˆé»˜è®¤ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯åˆ›å»ºRegistryå¯¹è±¡</span></span><br><span class="line"><span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br></pre></td></tr></table></figure>
<p><code>LocateRegistry</code>å¯¹è±¡çš„<code>createRegistry</code>ä¼šåˆ›å»º<code>RegistryImpl</code>æ¥å£å¯¹è±¡ï¼Œå¹¶ä¼ å…¥ç«¯å£å·1099</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">createRegistry</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegistryImpl</span>(port);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>RegistryImpl</code>ç±»çš„åˆ›å»ºæ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»º<code>LiveRef</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„åˆ›å»ºä¸­ä¼šé€šè¿‡<code>getLocalEndpoint</code>æ–¹æ³•ç¡®å®š<code>IP</code>å’Œç«¯å£å·ï¼Œä»¥åŠåˆå§‹åŒ–åé¢ä¼šä½¿ç”¨çš„<code>TCPTransport</code>å¯¹è±¡ï¼ˆæ— <code>socket</code>ï¼‰</p>
<p><img src="/post/a787da62/image-20240614151130924.png" alt="image-20240614151130924" style="zoom:50%;"></p>
<p>è¿”å›çš„<code>lref</code>çš„è¿”å›å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614151343681.png" alt="image-20240614151343681" style="zoom: 33%;"></p>
<p>æ¥ç€å°†<code>lref</code>ä½œä¸ºå‚æ•°ä¼ é€’åˆ°<code>UnicastServerRef</code>çš„æ–°å»ºæ–¹æ³•ä¸­ï¼Œå’ŒæœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡ç±»ä¼¼ï¼Œä¸»è¦çœ‹æ­¤å¤„çš„<code>setup</code>æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†<code>UnicastServerRef</code>å¯¹è±¡çš„<code>exportObject</code>å‡½æ•°ï¼Œæ­¤å¤„çš„<code>permanent</code>å‚æ•°ä¼ é€’ä¸º<code>true</code>ä»£è¡¨æ°¸ä¹…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">(UnicastServerRef uref)</span></span><br><span class="line">    <span class="keyword">throws</span> RemoteException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Server ref must be created and assigned before remote</span></span><br><span class="line"><span class="comment">     * object &#x27;this&#x27; can be exported.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ref = uref;</span><br><span class="line">    uref.exportObject(<span class="built_in">this</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UnicastServerRef</code>å¯¹è±¡çš„<code>exportObject</code>å‡½æ•°ä¸­åˆ›å»ºä»£ç†ï¼Œ<code>getClientRef()</code>è¿”å›çš„æ˜¯<code>UnicastRef</code>å¯¹è±¡ï¼ˆåŒ…å«åˆ›å»ºçš„<code>LiveRef</code>å¯¹è±¡ï¼‰</p>
<p><img src="/post/a787da62/image-20240614151900691.png" alt="image-20240614151900691" style="zoom:50%;"></p>
<p>ä½†æ˜¯å’Œåˆ›å»ºè¿œç¨‹æœåŠ¡ä¸åŒï¼Œæ­¤å¤„çš„<code>stub</code>è¿”å›çš„å¹¶ä¸æ˜¯ä¸€ä¸ªä»£ç†ï¼Œåœ¨<code>createProxy</code>æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª<code>if</code>è¯­å¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (forceStubUse ||</span><br><span class="line">    !(ignoreStubClasses || !stubClassExists(remoteClass)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> createStub(remoteClass, clientRef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ<code>remoteClass</code>ç±»ä½œä¸ºå‚æ•°ä¼ é€’çš„<code>stubClassExists</code>ä¸­åˆ¤æ–­<code>remoteClass_stub</code>ç±»å­˜åœ¨ï¼Œå°±ä¸é€šè¿‡ä»£ç†åˆ›å»ºæ–¹å¼åˆ›å»º<code>stub</code>ï¼Œä½†æ˜¯æ³¨å†Œæ¥å£ç±»<code>RegistryImpl_stub</code>æ˜¯å­˜åœ¨çš„ï¼Œå› æ­¤å°±ä¼šè¿›å…¥æ­¤å¤„çš„<code>if</code>å¾ªç¯ï¼Œè¿›å…¥æ­¤å¤„çš„<code>createStub</code>æ–¹æ³•ï¼Œç„¶åå°±ä¼šè·å–<code>RegistryImpl_stub</code>ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œéä»£ç†å¯¹è±¡ï¼Œå¹¶ä»¥åˆ›å»ºçš„<code>UnicastRef</code>å¯¹è±¡ä½œä¸ºå®ä¾‹åˆ›å»ºå‚æ•°</p>
<p>æœ€å<code>stub</code>è¿”å›çš„æ˜¯<code>RegistryImpl_stub</code>å®ä¾‹å¯¹è±¡ï¼Œæ¥ç€åˆä¼šè¿›å…¥æ­¤å¤„<code>if</code>å‡½æ•°ï¼Œæ‰§è¡Œ<code>setSkeleton</code>å‡½æ•°ï¼Œä»¥<code>RegistryImpl</code>å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (stub <span class="keyword">instanceof</span> RemoteStub) &#123;</span><br><span class="line">    setSkeleton(impl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åˆè°ƒç”¨<code>Util</code>çš„<code>createSkeleton</code>æ–¹æ³•</p>
<p><img src="/post/a787da62/image-20240614152708191.png" alt="image-20240614152708191" style="zoom:50%;"></p>
<p>ç›¸å½“äºå°±æ˜¯åˆ›å»º<code>RegistryImpl_Skel</code>çš„å®ä¾‹å¯¹è±¡</p>
<p><img src="/post/a787da62/image-20240614152808214.png" alt="image-20240614152808214" style="zoom:50%;"></p>
<p>ç„¶åå°†è®¾ç½®å¥½çš„</p>
<ul>
<li><p><code>impl</code>(<code>RegistryImpl</code>ç±»ï¼ŒåŒ…å«<code>Hashtable</code>ç±»çš„<code>bindings</code>å‚æ•°å’Œ<code>UnicastServerRef</code>ç±»çš„<code>ref</code>å‚æ•°ï¼Œå…¶ä¸­<code>ref</code>åŒ…å«åˆ›å»ºå¥½çš„<code>skel</code>(<code>RegistryImpl_Skel</code>å¯¹è±¡)ï¼Œ<code>ref</code>(<code>LiveRef</code>å¯¹è±¡))ï¼Œ</p></li>
<li><p><code>this</code>(<code>UnicastServerRef</code>ç±»ï¼ŒåŒ…å«åˆ›å»ºå¥½çš„<code>skel</code>(<code>RegistryImpl_Skel</code>å¯¹è±¡)ï¼Œ<code>ref</code>(<code>LiveRef</code>å¯¹è±¡))ï¼Œ</p></li>
<li><p><code>stub</code>(<code>ResitryImpl_Stub</code>ç±»ï¼ŒåŒ…å«<code>UnicastRef</code>ç±»çš„<code>ref</code>å‚æ•°ï¼Œ<code>ref</code>åŒ…å«åˆ›å»ºçš„<code>LiveRef</code>å¯¹è±¡)ï¼Œ</p></li>
</ul>
<p>ä½œä¸ºå‚æ•°æ–°å»º<code>Target</code>å˜é‡ï¼Œç„¶åé€šè¿‡<code>LiveRef</code>ç±»çš„<code>exportObject</code>æ–¹æ³•å»ºç«‹<code>socket</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Target</span>(impl, <span class="built_in">this</span>, stub, ref.getObjID(), permanent);</span><br><span class="line">ref.exportObject(target);</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±æ˜¯ç»‘å®šæ–¹æ³•<code>bind</code>çš„ä½¿ç”¨ï¼Œè¿™é‡Œçš„<code>registry</code>å°±æ˜¯åˆ›å»ºçš„<code>RegistryImpl_Stub</code>ç±»çš„å®ä¾‹å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯å°†è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°Registryå¯¹è±¡</span></span><br><span class="line">registry.bind(<span class="string">&quot;remoteObj&quot;</span>, remoteObj);</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„çš„<code>binding</code>åˆå§‹åŒ–ä¸ºç©ºï¼Œå› æ­¤ä¼šå°†ä¼ å…¥çš„å¯¹è±¡å’Œ<code>name</code>åŠ å…¥åˆ°<code>binding</code>åˆ—è¡¨ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bind</span><span class="params">(String name, Remote obj)</span></span><br><span class="line">    <span class="keyword">throws</span> RemoteException, AlreadyBoundException, AccessException</span><br><span class="line">&#123;</span><br><span class="line">    checkAccess(<span class="string">&quot;Registry.bind&quot;</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (bindings) &#123;</span><br><span class="line">        <span class="type">Remote</span> <span class="variable">curr</span> <span class="operator">=</span> bindings.get(name);</span><br><span class="line">        <span class="keyword">if</span> (curr != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AlreadyBoundException</span>(name);</span><br><span class="line">        bindings.put(name, obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼ŒæœåŠ¡ç«¯ä»£ç ä»‹ç»å®Œæ¯•</p>
<h3 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h3>
<h4 id="å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ">å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ</h4>
<p>é¦–å…ˆæŒ‡å®š<code>host</code>å’Œ<code>port</code>è·å–<code>Registry</code>å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  å®¢æˆ·ç«¯é€šè¿‡LocateRegistry.getRegistryæ–¹æ³•è·å–Registryå¯¹è±¡</span></span><br><span class="line"><span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>, <span class="number">1099</span>);</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è°ƒç”¨åŒåå‡½æ•°<code>getRegistry</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">getRegistry</span><span class="params">(String host, <span class="type">int</span> port)</span></span><br><span class="line">    <span class="keyword">throws</span> RemoteException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getRegistry(host, port, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ–°å»º<code>LiveRef</code>å¯¹è±¡ï¼Œä¼ å…¥<code>IP</code>å’Œ<code>port</code>ï¼Œå†ä»¥åˆ›å»ºçš„<code>LiveRef</code>ä½œä¸ºå‚æ•°åˆ›å»º<code>UnicastRef</code>å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç›¸å½“äºè¿™é‡Œçš„è·å–å®é™…ä¸Šå¹¶ä¸æ˜¯è·å–ï¼Œè€Œæ˜¯é€šè¿‡ä¼ å…¥çš„å‚æ•°åœ¨æœ¬åœ°åˆ›å»ºå¥½<code>RegistryImpl_Stub</code>ç±»çš„å®ä¾‹å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LiveRef</span> <span class="variable">liveRef</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LiveRef</span>(<span class="keyword">new</span> <span class="title class_">ObjID</span>(ObjID.REGISTRY_ID),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(host, port, csf, <span class="literal">null</span>),</span><br><span class="line">                <span class="literal">false</span>);</span><br><span class="line"><span class="type">RemoteRef</span> <span class="variable">ref</span> <span class="operator">=</span></span><br><span class="line">    (csf == <span class="literal">null</span>) ? <span class="keyword">new</span> <span class="title class_">UnicastRef</span>(liveRef) : <span class="keyword">new</span> <span class="title class_">UnicastRef2</span>(liveRef);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (Registry) Util.createProxy(RegistryImpl.class, ref, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>æ¥ç€é€šè¿‡<code>lookup</code>å¯»æ‰¾è¿œç¨‹å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  å®¢æˆ·ç«¯é€šè¿‡lookupæ–¹æ³•è·å–è¿œç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">IRemoteObj</span> <span class="variable">remoteObj</span> <span class="operator">=</span> (IRemoteObj) registry.lookup(<span class="string">&quot;remoteObj&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>lookup</code>ä¸­ä¼šè°ƒç”¨<code>UnicastRef</code>çš„<code>newCall</code>ï¼Œåœ¨<code>newCall</code>æ–¹æ³•ä¸­ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°åˆ›ç«‹è¿æ¥ï¼ŒåŒæ—¶åœ¨<code>lookup</code>ä¸­å°†ä¼ å…¥çš„è¿œç¨‹å¯¹è±¡åå­—ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å»ºç«‹çš„è¿æ¥å¯¹è±¡çš„åºåˆ—åŒ–çš„å‡½æ•°ä¸­ï¼Œæ„å‘³ç€æ˜¯å°†è¯¥å‚æ•°è¿›è¡Œåºåˆ—åŒ–ä¼ é€’ç»™æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒä¼šè´Ÿè´£è¿›è¡Œååºåˆ—åŒ–</p>
<p><img src="/post/a787da62/image-20240614163338442.png" alt="image-20240614163338442" style="zoom: 33%;"></p>
<p>è¿”å›çš„å‚æ•°<code>var2</code>å¦‚ä¸‹</p>
<p><img src="/post/a787da62/image-20240614163025294.png" alt="image-20240614163025294" style="zoom:50%;"></p>
<p>ç„¶åä¼šè°ƒç”¨<code>invoke</code>æ–¹æ³•ï¼Œ<code>invoke</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨
<code>call.executeCall();</code>
ï¼Œè¯¥æ–¹æ³•å°±æ˜¯å¤„ç†å®¢æˆ·ç«¯ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•</p>
<p>æ¥ç€å®¢æˆ·ç«¯ä¼šæ¥å—æ³¨å†Œä¸­å¿ƒçš„è¿”å›ç»“æœï¼ŒåŒæ ·ï¼Œè¦è¿›è¡Œååºåˆ—åŒ–æ‰èƒ½è·å–</p>
<p><img src="/post/a787da62/image-20240614163547092.png" alt="image-20240614163547092" style="zoom:33%;"></p>
<p><strong>å› æ­¤æ”»å‡»æ‰‹æ®µå¯ä»¥è€ƒè™‘ï¼Œæ¨¡æ‹Ÿæ³¨å†Œä¸­å¿ƒï¼Œå‘å®¢æˆ·ç«¯å‘é€æœ‰å±å®³çš„åºåˆ—åŒ–ä»£ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶åˆ™ä¼šäº§ç”Ÿæ¼æ´</strong></p>
<p><strong>å¦å¤–åœ¨<code>invoke</code>æ–¹æ³•ä¸­ï¼Œå½“äº§ç”Ÿå¼‚å¸¸<code>TransportConstants.ExceptionalReturn</code>æ—¶ä¹Ÿä¼šè°ƒç”¨<code>readObject</code>æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> TransportConstants.ExceptionalReturn:</span><br><span class="line">    Object ex;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ex = in.readObject();</span><br></pre></td></tr></table></figure>
<p>å› æ­¤åªè¦æœ‰<code>invoke</code>æ–¹æ³•æˆ–è€…<code>readObject</code>æ–¹æ³•éƒ½æœ‰å¯èƒ½äº§ç”Ÿå¨èƒ</p>
<h4 id="å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯">å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯</h4>
<p>æ­¤å¤„å®¢æˆ·ç«¯é€šè¿‡<code>lookup</code>æ–¹æ³•è·å–è¿œç¨‹å¯¹è±¡<code>remoteObj</code>æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå› æ­¤ä¼šæ‰§è¡Œ<code>UnicastRef</code>çš„<code>invoke</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">System.out.println(remoteObj.sayHello(<span class="string">&quot;Hello, World!&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>invoke</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ›å»ºè¿æ¥</p>
<p><img src="/post/a787da62/image-20240614164948844.png" alt="image-20240614164948844" style="zoom:50%;"></p>
<p>ç„¶ååˆ›å»ºè¿œç¨‹è°ƒç”¨æ–¹æ³•å¯¹è±¡ï¼Œç„¶åå°†è¦ä¼ é€’çš„å˜é‡é€šè¿‡<code>marshaValue</code>è¿›è¡Œåºåˆ—åŒ–</p>
<p><img src="/post/a787da62/image-20240614165259985.png" alt="image-20240614165259985" style="zoom:33%;"></p>
<p><code>marshaValue</code>ä¸­å°±æ˜¯å¯¹å‚æ•°è¿›è¡Œåºåˆ—åŒ–</p>
<p><img src="/post/a787da62/image-20240614165327093.png" alt="image-20240614165327093" style="zoom:50%;"></p>
<p>ç„¶ååˆæ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼ˆè¿™é‡Œä¸»è¦æ˜¯å¤„ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡çš„<code>JRMP</code>åè®®ï¼Œå½“å‡ºç°æŒ‡å®šå¼‚å¸¸æ—¶å¯åˆ©ç”¨ï¼‰</p>
<p>æ¥ç€è·å–è¿”å›å€¼ç„¶åé€šè¿‡<code>unmarshalValue</code>è¿›è¡Œååºåˆ—åŒ–</p>
<p><img src="/post/a787da62/image-20240614165519789.png" alt="image-20240614165519789" style="zoom:50%;"></p>
<h3 id="å®¢æˆ·ç«¯-æœåŠ¡ç«¯">å®¢æˆ·ç«¯-æœåŠ¡ç«¯</h3>
<h4 id="å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒæ—¶çš„æœåŠ¡ç«¯">å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒæ—¶çš„æœåŠ¡ç«¯</h4>
<p>æœåŠ¡ç«¯åœ¨åˆ›å»ºæ³¨å†Œä¸­å¿ƒæ—¶å®é™…ä¸Šä¼šå°†åˆ›å»ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨targetä¸­ï¼Œç„¶ååˆ›å»ºå¼€å¯ç½‘ç»œç›‘å¬ï¼Œåˆ›å»ºæ–°çº¿ç¨‹ï¼Œä¼šæ–°å»ºskelå®ä¾‹ï¼Œå› æ­¤è¯¥å®ä¾‹åº”æ˜¯æœåŠ¡ç«¯ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚çš„ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡lookupå¯»æ‰¾è¿œç¨‹æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯åº”æ”¶åˆ°è¯·æ±‚å¹¶è¿”å›è¿œç¨‹æœåŠ¡å¯¹è±¡ï¼Œå› æ­¤ï¼Œä¸»è¦æŸ¥çœ‹RegistryImpl_Skelç±»å®šä¹‰çš„å‡½æ•°ï¼Œ<code>dispatch</code>
å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯æ¥æ”¶å¹¶å¤„ç†ä»å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ã€‚æ ¹æ®è¯·æ±‚çš„å†…å®¹ï¼Œè°ƒç”¨ç›¸åº”çš„æ–¹æ³•æ¥æ‰§è¡Œ</p>
<p><img src="/post/a787da62/image-20240615143550267.png" alt="image-20240615143550267" style="zoom:50%;"></p>
<p>ç°åœ¨æŸ¥çœ‹æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹å¯¹è±¡æ—¶socketåˆ›å»ºæ–°è¿›ç¨‹çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯TCPTransportçš„listenå‡½æ•°ï¼Œåœ¨è¿™é‡Œé¢ä¼šåˆ›å»ºæ–°è¿›ç¨‹ï¼Œæ‰§è¡Œç±»ä¸ºAcceptLoop</p>
<p><img src="/post/a787da62/image-20240616101922514.png" alt="image-20240616101922514" style="zoom:33%;"></p>
<p>æŸ¥çœ‹AcceptLoopçš„runæ–¹æ³•</p>
<p><img src="/post/a787da62/image-20240616102003153.png" alt="image-20240616102003153" style="zoom:33%;"></p>
<p>æŸ¥çœ‹executeAcceptLoopæ–¹æ³•ï¼Œè¿™é‡Œé¢åˆæ‰§è¡Œäº†ConnectionHandlerç±»</p>
<p><img src="/post/a787da62/image-20240616102039718.png" alt="image-20240616102039718" style="zoom:33%;"></p>
<p>ConnectionHandlerç±»çš„runæ–¹æ³•æ‰§è¡Œäº†run0æ–¹æ³•ï¼Œrun0æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªè¯»å–input
messagesçš„å‡½æ•°handleMessages,è¿™é‡Œé¢åº”è¯¥å°±æ˜¯è¯»å–å®¢æˆ·ç«¯ä¿¡æ¯çš„å‡½æ•°ï¼Œå’‹å­handleMessageså‡½æ•°ä¸­ä¼šæ ¹æ®ä¼ è¾“çš„ä¸åŒå­—æ®µå€¼è°ƒç”¨ä¸åŒå‡½æ•°ï¼Œé»˜è®¤æ˜¯serviceCallå‡½æ•°</p>
<p><img src="/post/a787da62/image-20240616102632213.png" alt="image-20240616102632213" style="zoom:33%;"></p>
<p>åœ¨serviceCallå‡½æ•°ä¸­ä¼šè·å–åˆ›å»ºè¿‡çš„targetï¼Œæ­¤æ—¶çš„target</p>
<p><img src="/post/a787da62/image-20240616131547037.png" alt="image-20240616131547037" style="zoom: 33%;"></p>
<p>åœ¨æ­¤å¤„å¢åŠ æ–­ç‚¹ï¼Œå¹¶å‘èµ·å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ¥ç€ä¼šè·å–targeté‡Œé¢çš„åˆ†å‘å™¨ï¼Œè¿™æ—¶å€™è·å–åˆ°çš„åˆ†å‘å™¨å°±æ˜¯æœ‰skelçš„UnicastServerRefç±»å¯¹è±¡ï¼Œåº”è¯¥æ˜¯å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</p>
<p><img src="/post/a787da62/image-20240616102946645.png" alt="image-20240616102946645" style="zoom:50%;"></p>
<p>ç„¶åä¼šè°ƒç”¨disp(åˆ†å‘å™¨)çš„dispatchæ–¹æ³•</p>
<p><img src="/post/a787da62/image-20240616103126724.png" alt="image-20240616103126724" style="zoom:50%;"></p>
<p>åœ¨dispatchä¸­å¦‚æœskelå¹¶ä¸æ˜¯nullå°±ä¼šè°ƒç”¨oldDispatchæ–¹æ³•ï¼ŒoldDispatchæ–¹æ³•ä¸­ä¼šè°ƒç”¨skelçš„dispatchæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (skel != <span class="literal">null</span>) &#123;</span><br><span class="line">    oldDispatch(obj, call, num);</span><br><span class="line">    <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨skelçš„dispatchæ–¹æ³•ä¸­ï¼Œæ‰§è¡Œè¯­å¥å¦‚ä¸‹ï¼Œå½“var3ä¸º0ï¼Œä»£è¡¨ç»‘å®šå‘½ä»¤ï¼Œ1ä»£è¡¨listå‘½ä»¤ï¼Œ2ä»£è¡¨lookup(ä»æ³¨å†Œä¸­å¿ƒå¯»æ‰¾å¯¹åº”çš„è¿œç¨‹å¯¹è±¡)...ä¼ å…¥lookupçš„å‚æ•°var7æ˜¯é€šè¿‡ååºåˆ—åŒ–è¯»å‡ºæ¥çš„ï¼Œè¯¥å¤„æœ‰è¢«æ”»å‡»å¯èƒ½æ€§ï¼Œæ­¤å¤„æ‰€æœ‰çš„caseéƒ½æœ‰readObjectæ–¹æ³•ï¼Œéƒ½æœ‰è¢«æ”»å‡»çš„å¯èƒ½æ€§</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (var3) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">		<span class="comment">//..</span></span><br><span class="line">        var6.bind(var7, var8);</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        String[] var97 = var6.list();</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var10 = var2.getInputStream();</span><br><span class="line">            var7 = (String)var10.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var89) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnmarshalException</span>(<span class="string">&quot;error unmarshalling arguments&quot;</span>, var89);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var90) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnmarshalException</span>(<span class="string">&quot;error unmarshalling arguments&quot;</span>, var90);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            var2.releaseInputStream();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var8 = var6.lookup(var7);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        var6.rebind(var7, var8);</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        var6.unbind(var7);</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnmarshalException</span>(<span class="string">&quot;invalid method number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯æ—¶æœåŠ¡ç«¯">å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯æ—¶æœåŠ¡ç«¯</h4>
<p>è¿˜æ˜¯ä¸€æ ·çš„è¿è¡Œæµç¨‹ï¼Œä¸åŒçš„æ˜¯æ­¤æ—¶è·å–çš„targetæ˜¯å¦‚ä¸‹ä¿¡æ¯ï¼Œå…¶ä¸­çš„stubå˜æˆäº†åŠ¨æ€ä»£ç†ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡å»ºç«‹çš„åŠ¨æ€ä»£ç†ï¼Œå‰é¢çš„targetæ˜¯æœåŠ¡å™¨åˆ›å»ºæ³¨å†Œä¸­å¿ƒæ—¶åˆ›å»ºçš„RegistryImpl_stubç±»çš„æ–°å®ä¾‹</p>
<p><img src="/post/a787da62/image-20240616131710853.png" alt="image-20240616131710853" style="zoom: 33%;"></p>
<p>æ­¤æ—¶çš„skelä¸ºnullï¼Œæ­¤å¤„ä¸æ‰§è¡ŒoldDispatchå‡½æ•°</p>
<p><img src="/post/a787da62/image-20240616132405085.png" alt="image-20240616132405085" style="zoom:33%;"></p>
<p>ç„¶åè·å–methodæ–¹æ³•ï¼Œå¹¶è°ƒç”¨logCallè®°å½•</p>
<p><img src="/post/a787da62/image-20240616132501602.png" alt="image-20240616132501602" style="zoom:33%;"></p>
<p>æ¥ç€è·å–å‚æ•°ç±»å‹ï¼Œå¹¶è·å–ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œæ­¤å¤„çš„unmarshalValueå’Œä¸Šé¢åˆ†æçš„ä¸€æ ·ï¼Œæ˜¯å¯¹å‚æ•°è¿›è¡Œååºåˆ—åŒ–ï¼ˆå¯åˆ©ç”¨ï¼‰</p>
<p><img src="/post/a787da62/image-20240616132558249.png" alt="image-20240616132558249" style="zoom: 33%;"></p>
<p>ç„¶åè°ƒç”¨<code>invoke</code>å‡½æ•°æ‰§è¡Œæ–¹æ³•`</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = method.invoke(obj, params);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> e.getTargetException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæŠŠè¿”å›å€¼åºåˆ—åŒ–åä¼ é€’å›å»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectOutput</span> <span class="variable">out</span> <span class="operator">=</span> call.getResultStream(<span class="literal">true</span>);</span><br><span class="line">Class&lt;?&gt; rtype = method.getReturnType();</span><br><span class="line"><span class="keyword">if</span> (rtype != <span class="keyword">void</span>.class) &#123;</span><br><span class="line">    marshalValue(rtype, result, out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dgcå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯">DGC(å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯)</h3>
<blockquote>
<p>åœ¨å‰é¢çš„è¿‡ç¨‹ä¸­å»ºç«‹äº†<code>DGCImpl</code> ç±»ï¼Œè¿™æ˜¯ Java RMI
æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œä»£è¡¨åˆ†å¸ƒå¼åƒåœ¾å›æ”¶ (Distributed Garbage Collection, DGC)
çš„å®ç°ã€‚<code>dispatch</code> å‡½æ•°åœ¨ <code>DGCImpl_Skel</code>
ç±»ä¸­ä¸»è¦è´Ÿè´£å¤„ç†ä¸åˆ†å¸ƒå¼åƒåœ¾å›æ”¶ç›¸å…³çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>åˆ†å¸ƒå¼åƒåœ¾å›æ”¶ç”¨äºç®¡ç†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œ<code>DGCImpl</code>
ç±»é€šå¸¸æä¾›çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ol type="1">
<li><code>dirty</code>ï¼šç”¨äºæ³¨å†Œä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li><code>clean</code>ï¼šç”¨äºæ³¨é”€ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</li>
</ol>
</blockquote>
<p>ç‰¹ç‚¹ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œåªè¦åˆ›å»ºäº†è¿œç¨‹å¯¹è±¡å°±ä¸€å®šä¼šåˆ›å»ºDGC</p>
<p>åˆ›å»ºå®Œè¿œç¨‹å¯¹è±¡ï¼Œä¼šæŠŠæ‰€æœ‰çš„å˜é‡æ”¾åœ¨targetä¸­ï¼Œç„¶åæ”¾åœ¨ä¸€ä¸ªé™æ€è¡¨ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target target)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    target.setExportedTransport(<span class="built_in">this</span>);</span><br><span class="line">    ObjectTable.putTarget(target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putTarget</span><span class="params">(Target target)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">	objTable.put(oe, target);</span><br><span class="line">    implTable.put(weakImpl, target);</span><br><span class="line">    <span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>ä½†åœ¨putä¹‹å‰ï¼ŒobjTableè¡¨ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªTargetç±»ï¼Œä¹Ÿæœ‰ä¸€ä¸ªstub(DGCImpl_Stub)ï¼Œè¯´æ˜åœ¨è¿™ä¹‹å‰å·²ç»åˆ›å»ºäº†DGCImpl_Stubå®ä¾‹å¯¹è±¡</p>
<p><img src="/post/a787da62/image-20240617211152942.png" alt="image-20240617211152942" style="zoom:33%;"></p>
<p>å›è¿‡å¤´çœ‹DGCImpl_Stubå®ä¾‹å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œäº‹å®ä¸Šï¼Œåœ¨putTargetå‡½æ•°ä¸­å°±æœ‰è¯¥è¿‡ç¨‹</p>
<p><img src="/post/a787da62/image-20240617211342125.png" alt="image-20240617211342125" style="zoom:50%;"></p>
<p>è¿™é‡Œçš„dgcLogæ˜¯DGCImplç±»çš„é™æ€å˜é‡ï¼Œå½“å¼•ç”¨é™æ€å˜é‡æ—¶ï¼Œä¼šæ‰§è¡Œé™æ€ä»£ç å—static{}é‡Œçš„å†…å®¹ï¼ŒæŸ¥çœ‹DGCImplçš„static{}é‡Œçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œæ­¤å¤„çš„runå‡½æ•°</p>
<p><img src="/post/a787da62/image-20240617211647714.png" alt="image-20240617211647714" style="zoom:33%;"></p>
<p>åœ¨runå‡½æ•°åé¢ï¼Œä¼šæ–°å»ºDGCImplç±»å¯¹è±¡ï¼Œå¹¶æ–°å»ºLiveRefç±»å¯¹è±¡ï¼Œæ¥ç€æ–°å»ºUnicastServerRefå¯¹è±¡ï¼Œå¹¶è®¾ç½®stubï¼Œè®¾ç½®skelï¼Œæ–°å»ºtargetï¼Œå¹¶é€šè¿‡putå°†targetæ”¾å…¥é™æ€è¡¨ä¸­ï¼Œè¿™é‡Œåˆ›å»ºçš„DGCImplçš„åŠŸèƒ½å’Œæ³¨å†Œä¸­å¿ƒæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯æœ‰ä¸€ä¸ªç«¯å£ï¼Œå»ºç«‹çš„æ˜¯å®ä¾‹å¯¹è±¡è€ŒéåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œç”¨äºè¿œç¨‹å›æ”¶æœåŠ¡ï¼Œè°ƒç”¨æ—¶ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¼šè°ƒç”¨å…¶dispçš„dispatchæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dgc = <span class="keyword">new</span> <span class="title class_">DGCImpl</span>();</span><br><span class="line"><span class="type">ObjID</span> <span class="variable">dgcID</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjID</span>(ObjID.DGC_ID);</span><br><span class="line"><span class="type">LiveRef</span> <span class="variable">ref</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LiveRef</span>(dgcID, <span class="number">0</span>);</span><br><span class="line"><span class="type">UnicastServerRef</span> <span class="variable">disp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnicastServerRef</span>(ref);</span><br><span class="line"><span class="type">Remote</span> <span class="variable">stub</span> <span class="operator">=</span></span><br><span class="line">    Util.createProxy(DGCImpl.class,</span><br><span class="line">                     <span class="keyword">new</span> <span class="title class_">UnicastRef</span>(ref), <span class="literal">true</span>);</span><br><span class="line">disp.setSkeleton(dgc);</span><br><span class="line"></span><br><span class="line"><span class="type">Permissions</span> <span class="variable">perms</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Permissions</span>();</span><br><span class="line">perms.add(<span class="keyword">new</span> <span class="title class_">SocketPermission</span>(<span class="string">&quot;*&quot;</span>, <span class="string">&quot;accept,resolve&quot;</span>));</span><br><span class="line">ProtectionDomain[] pd = &#123; <span class="keyword">new</span> <span class="title class_">ProtectionDomain</span>(<span class="literal">null</span>, perms) &#125;;</span><br><span class="line"><span class="type">AccessControlContext</span> <span class="variable">acceptAcc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccessControlContext</span>(pd);</span><br><span class="line"></span><br><span class="line"><span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span> AccessController.doPrivileged(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Target&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> Target <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Target</span>(dgc, disp, stub, dgcID, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, acceptAcc);</span><br><span class="line"></span><br><span class="line">ObjectTable.putTarget(target);</span><br></pre></td></tr></table></figure>
<h4 id="dgcimpl_stubå®¢æˆ·ç«¯">DGCImpl_stub(å®¢æˆ·ç«¯)</h4>
<p>dirtyå‡½æ•°ä¸­ï¼Œè°ƒç”¨äº†invoke(å­˜åœ¨é£é™©)</p>
<p><img src="/post/a787da62/image-20240617212457265.png" alt="image-20240617212457265" style="zoom:33%;"></p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ååºåˆ—åŒ–æ¼æ´</p>
<p><img src="/post/a787da62/image-20240617212619027.png" alt="image-20240617212619027" style="zoom:33%;"></p>
<p>cleanå‡½æ•°ä¸­ï¼Œä¹Ÿè°ƒç”¨äº†invoke(å­˜åœ¨é£é™©)</p>
<p><img src="/post/a787da62/image-20240617212533978.png" alt="image-20240617212533978" style="zoom:33%;"></p>
<h4 id="dgcimpl_skelæœåŠ¡ç«¯">DGCImpl_skel(æœåŠ¡ç«¯)</h4>
<p>åŒæ ·å­˜åœ¨æ¼æ´</p>
<p><img src="/post/a787da62/image-20240617212724556.png" alt="image-20240617212724556" style="zoom: 25%;"><img src="/post/a787da62/image-20240617212745327.png" alt="image-20240617212745327" style="zoom:33%;"></p>
<h3 id="jdké«˜ç‰ˆæœ¬ç»•è¿‡">JDKé«˜ç‰ˆæœ¬ç»•è¿‡</h3>
<p>çº¦æŸè¾“å…¥æµç±»å‹ï¼Œåªæœ‰ç¬¦åˆç™½åå•çš„æ‰å…è®¸è¢«ååºåˆ—åŒ–ï¼Œåœ¨RegistryImplç±»ä¸­å®šä¹‰äº†registryFilteræ–¹æ³•</p>
<p><img src="/post/a787da62/image-20240617213238832.png" alt="image-20240617213238832" style="zoom:33%;"></p>
<p>åœ¨DGCä¸­ä¹Ÿæœ‰äº†é™åˆ¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (clazz == ObjID.class ||</span><br><span class="line">        clazz == UID.class ||</span><br><span class="line">        clazz == VMID.class ||</span><br><span class="line">        clazz == Lease.class)</span><br><span class="line">        ? ObjectInputFilter.Status.ALLOWED</span><br><span class="line">        : ObjectInputFilter.Status.REJECTED;</span><br></pre></td></tr></table></figure>
<p>è€ƒè™‘åˆ©ç”¨æ­¤å¤„çš„UnicastRefç±»ï¼Œå­˜åœ¨invokeï¼Œå­˜åœ¨jrmp
clientååºåˆ—åŒ–æ”»å‡»ï¼Œæ‰€æœ‰rmiå®¢æˆ·ç«¯</p>
<p><img src="/post/a787da62/image-20240617213734213.png" alt="image-20240617213734213" style="zoom:33%;"></p>
<p>æ€è€ƒç›®æ ‡ï¼šåœ¨æœåŠ¡ç«¯å¼€å¯å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡ç«¯è¢«æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆåœ¨æœåŠ¡ç«¯è°ƒç”¨UnicastRefç±»çš„invokeå‡½æ•°</p>
<p><img src="/post/a787da62/image-20240622154350020.png" alt="image-20240622154350020" style="zoom:33%;"></p>
<p>è°ƒç”¨invokeçš„å¯¹è±¡å¤§å¤šæ˜¯Registry_stubå’ŒDGCImpl_stubé‡Œï¼Œstubå¯¹è±¡æ˜¯åœ¨createPorxyå‡½æ•°ä¸­è°ƒç”¨çš„ï¼Œè€Œå‰è€…çš„createproxyæ˜¯åœ¨exportObjectåˆ›å»ºæ³¨å†Œä¸­å¿ƒæ—¶åˆ›å»ºçš„ï¼Œåè€…åœ¨åˆ›å»ºè¿œç¨‹æœåŠ¡å°±å·²ç»åˆ›å»ºäº†ï¼Œåœ¨DGCçš„é™æ€ä»£ç å—å’ŒDGCClientç±»çš„EndPointEntryå‡½æ•°ä¸­éƒ½æœ‰è°ƒç”¨</p>
<p><img src="/post/a787da62/image-20240617215553337.png" alt="image-20240617215553337" style="zoom: 33%;"></p>
<p>æˆ‘ä»¬è¦æ‰¾åˆ°ä¸€ä¸ªååºåˆ—åŒ–ç‚¹ï¼Œé€šè¿‡ååºåˆ—åŒ–èƒ½å¤Ÿå®ç°è°ƒç”¨æ­¤å¤„çš„å‡½æ•°åˆ›å»ºDGCImpl_stubå¯¹è±¡ï¼Œå¹¶è°ƒç”¨invokeæ–¹æ³•</p>
<ol type="1">
<li>åœ¨æœåŠ¡ç«¯ä¸Šåˆ›å»ºDGCClientå¯¹è±¡ï¼Œåˆ›å»ºdgcå¯¹è±¡</li>
<li>è®©dgcå¯¹è±¡åœ¨æœåŠ¡ç«¯ä¸Šå‘èµ·å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ‰§è¡Œinvokeå‡½æ•°</li>
</ol>
<h4 id="åˆ›å»ºdgcå¯¹è±¡">åˆ›å»ºdgcå¯¹è±¡</h4>
<p>é¦–å…ˆæ‰¾è°ƒç”¨DGCClientç±»çš„EndPointEntryå‡½æ•°çš„ä½ç½®ï¼Œå›æº¯åˆ°StreamRemoteCallçš„releaseInputStreamæ–¹æ³•,è€Œè¿™ä¸ªå‡½æ•°æ˜¯åœ¨skelé‡Œè¢«è°ƒç”¨ï¼Œæ‰€ä»¥å¯åˆ©ç”¨ï¼Œä¸‹å›¾æ˜¯releaseInputStreamé‡Œè°ƒç”¨çš„registerRefsæ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦ä¿è¯!incomingRefTable.isEmpty()ç»“æœä¸ºçœŸï¼Œä¹Ÿå°±æ˜¯incomingRefTableä¸ä¸ºç©º</p>
<p><img src="/post/a787da62/image-20240622161211181.png" alt="image-20240622161211181" style="zoom:33%;"></p>
<p>incomingRefTableæ˜¯åœ¨saveRefä¸­è¢«èµ‹å€¼ï¼ŒsaveRefåœ¨LiveRefçš„readä¸­è¢«è°ƒç”¨ï¼Œreadæ–¹æ³•è¢«UnicastRefçš„readExternalæ–¹æ³•è°ƒç”¨ï¼ŒreadExternalå’ŒreadObjectç±»ä¼¼ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œåªè¦å®ç°ååºåˆ—åŒ–UnicastRefå¯¹è±¡ï¼Œå°±å¯ä»¥å®ç°åˆ›å»ºDGCå¯¹è±¡ï¼Œå°†åºåˆ—åŒ–åçš„UnicastRefå¯¹è±¡ä¼ é€’åˆ°RegistyImplä¸­ï¼Œç”±äºUnicastRefåœ¨ç™½åå•ï¼Œå› æ­¤å¯ä»¥è¢«æ­£å¸¸ååºåˆ—åŒ–ï¼Œæœ€ç»ˆå®ç°DGCå¯¹è±¡çš„åˆ›å»º</p>
<h4 id="è°ƒç”¨invoke">è°ƒç”¨invoke</h4>
<p>åœ¨DGCClientä¸­åˆ›å»ºdgcå¯¹è±¡ä¹‹åï¼Œè¿›å…¥äº†æ–°çš„çº¿ç¨‹å‡½æ•°RenewCleanThread</p>
<p><img src="/post/a787da62/image-20240622162542059.png" alt="image-20240622162542059" style="zoom:50%;"></p>
<p>åœ¨RenewCleanThreadä¸­è°ƒç”¨äº†makeDirtyCallå‡½æ•°ï¼ŒmakeDirtyCallå‡½æ•°ä¸­è°ƒç”¨äº†dirtyå‡½æ•°ï¼Œç”±æ­¤æ¥è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ååºåˆ—åŒ–æ”»å‡»</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>rmi_1</p><p><a href="http://example.com/post/a787da62.html">http://example.com/post/a787da62.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>yyyyyyxnp</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-06-13</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-09-29</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/java/">java</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/post/eb02829d.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">JNDIå­¦ä¹ </span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/post/4ffaad45.html"><span class="level-item">CommonsCollections</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="Yyyyyyxnp"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Yyyyyyxnp</p><p class="is-size-6 is-block">Student Yang</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fudan University</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">7</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/deng12yx" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/deng12yx"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#åˆè¯†rmi"><span class="level-left"><span class="level-item">1</span><span class="level-item">åˆè¯†RMI</span></span></a></li><li><a class="level is-mobile" href="#æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">2</span><span class="level-item">æœåŠ¡ç«¯</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">æœåŠ¡ç«¯åˆ›å»ºè¿œç¨‹æœåŠ¡</span></span></a></li><li><a class="level is-mobile" href="#åˆ›å»ºæ³¨å†Œä¸­å¿ƒç»‘å®š"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">åˆ›å»ºæ³¨å†Œä¸­å¿ƒ+ç»‘å®š</span></span></a></li></ul></li><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯"><span class="level-left"><span class="level-item">3</span><span class="level-item">å®¢æˆ·ç«¯</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ</span></span></a></li><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯</span></span></a></li></ul></li><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯-æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">4</span><span class="level-item">å®¢æˆ·ç«¯-æœåŠ¡ç«¯</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒæ—¶çš„æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒæ—¶çš„æœåŠ¡ç«¯</span></span></a></li><li><a class="level is-mobile" href="#å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯æ—¶æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯æ—¶æœåŠ¡ç«¯</span></span></a></li></ul></li><li><a class="level is-mobile" href="#dgcå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯"><span class="level-left"><span class="level-item">5</span><span class="level-item">DGC(å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#dgcimpl_stubå®¢æˆ·ç«¯"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">DGCImpl_stub(å®¢æˆ·ç«¯)</span></span></a></li><li><a class="level is-mobile" href="#dgcimpl_skelæœåŠ¡ç«¯"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">DGCImpl_skel(æœåŠ¡ç«¯)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#jdké«˜ç‰ˆæœ¬ç»•è¿‡"><span class="level-left"><span class="level-item">6</span><span class="level-item">JDKé«˜ç‰ˆæœ¬ç»•è¿‡</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#åˆ›å»ºdgcå¯¹è±¡"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">åˆ›å»ºdgcå¯¹è±¡</span></span></a></li><li><a class="level is-mobile" href="#è°ƒç”¨invoke"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">è°ƒç”¨invoke</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-09-01T13:27:46.000Z">2025-09-01</time></p><p class="title"><a href="/post/faa1c95e.html">ctfshowåˆå­¦</a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/post/b64de532.html"><img src="/img/article/23.png" alt="ai_tools"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-25T05:34:16.000Z">2024-12-25</time></p><p class="title"><a href="/post/b64de532.html">ai_tools</a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/post/d75064c8.html"><img src="/img/article/18.png" alt="åŸºç¡€çŸ¥è¯†å­¦ä¹ "></a></figure><div class="media-content"><p class="date"><time dateTime="2024-10-09T11:54:53.000Z">2024-10-09</time></p><p class="title"><a href="/post/d75064c8.html">åŸºç¡€çŸ¥è¯†å­¦ä¹ </a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/post/9c1a1a1.html"><img src="/img/article/17.png" alt="luogu_1"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-10-08T10:50:27.000Z">2024-10-08</time></p><p class="title"><a href="/post/9c1a1a1.html">luogu_1</a></p><p class="categories"><a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/post/7684f23b.html"><img src="/img/article/15.png" alt="T2I"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-09-23T06:17:27.000Z">2024-09-23</time></p><p class="title"><a href="/post/7684f23b.html">T2I</a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8/">å®‰å…¨</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">BeautyFlower</a><p class="is-size-7"><span>&copy; 2025 yyyyyyxnp</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7">Â© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/deng12yx"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'folded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>